This derivation formulates the error propagation model for a research paper. It establishes the "First Principles" of the POW4R solver and rigorously derives the sensitivity of the output velocity vector $\mathbf{v} = [v_x, v_y, v_z]^T$ to perturbations in the four primary input variables.

### 1. Mathematical Formulation

#### 1.1 Coordinate System & Definitions
Let the system be defined in the **Camera Coordinate Frame**:
* $\mathbf{P} = [X, Y, Z]^T$: The 3D position of the point.
* $\mathbf{p} = [u, v]^T$: The 2D projected pixel coordinates on the normalized image plane, where $u=X/Z$ and $v=Y/Z$.
* $\dot{\mathbf{p}} = [\dot{u}, \dot{v}]^T$: The observed optical flow.
* $\mathbf{v} = [v_x, v_y, v_z]^T$: The unknown 3D velocity vector we wish to estimate.
* $\mathbf{r} = [r_x, r_y, r_z]^T$: The radar unit vector (direction of the beam).
* $v_r$: The measured radial (Doppler) velocity.

#### 1.2 The Governing Constraints
The solver linearizes the problem by combining the Pinhole Camera Model derivative and the Doppler Projection.

**Constraint 1: The Optical Flow Equations**
Differentiating the pinhole model $u = X/Z$ with respect to time yields:
$$\dot{u} = \frac{v_x Z - X v_z}{Z^2} = \frac{v_x}{Z} - \frac{u v_z}{Z}$$
Multiplying by $Z$ to linearize relative to velocity:
$$v_x - u v_z = Z \dot{u} \quad \dots \text{(Eq. 1)}$$
Similarly for the vertical component:
$$v_y - v v_z = Z \dot{v} \quad \dots \text{(Eq. 2)}$$

**Constraint 2: The Radial Velocity Equation**
The projection of the 3D velocity onto the radar unit vector:
$$r_x v_x + r_y v_y + r_z v_z = v_r \quad \dots \text{(Eq. 3)}$$

#### 1.3 The Closed-Form Solution
To find the sensitivity, we must solve this system symbolically. We substitute (Eq. 1) and (Eq. 2) into (Eq. 3).

Substitute $v_x = Z \dot{u} + u v_z$ and $v_y = Z \dot{v} + v v_z$ into (Eq. 3):
$$r_x (Z \dot{u} + u v_z) + r_y (Z \dot{v} + v v_z) + r_z v_z = v_r$$

Grouping the terms for $v_z$:
$$v_z (r_x u + r_y v + r_z) + Z(r_x \dot{u} + r_y \dot{v}) = v_r$$

Let $D = (r_x u + r_y v + r_z)$ be the geometric denominator.
Solving for the longitudinal velocity $v_z$:
$$v_z = \frac{v_r - Z(r_x \dot{u} + r_y \dot{v})}{D} \quad \dots \text{(Eq. 4)}$$

This (Eq. 4) along with (Eq. 1) and (Eq. 2) constitutes the complete solution. We will now introduce errors to the inputs ($v_r, Z, r_x, r_y$) and observe the deviation $\Delta \mathbf{v}$ in the outputs.

---

### 2. Sensitivity Analysis (The 12 Combinations)

We assume a standard object configuration where the object is roughly in front of the vehicle. This implies $r_x \approx 0, r_y \approx 0, r_z \approx 1$. Consequently, $D \approx 1$.

#### Case I: Radial Velocity Error ($\epsilon_{vr}$)
**Scenario:** The radar Doppler measurement is perturbed: $\tilde{v}_r = v_r + \epsilon_{vr}$.
**Mechanism:** This error enters the numerator of the $v_z$ solution (Eq. 4) additively.

1.  **Derivation for $\Delta v_z$:**
    $$\tilde{v}_z = \frac{(v_r + \epsilon_{vr}) - \dots}{D} = v_z + \frac{\epsilon_{vr}}{D}$$
    Since $D \approx 1$:
    $$\Delta v_z \approx \epsilon_{vr}$$

2.  **Derivation for $\Delta v_x$:**
    From (Eq. 1), $v_x$ depends on $v_z$:
    $$\tilde{v}_x = Z \dot{u} + u \tilde{v}_z = Z \dot{u} + u(v_z + \epsilon_{vr})$$
    $$\Delta v_x = u \epsilon_{vr}$$

3.  **Derivation for $\Delta v_y$:**
    From (Eq. 2):
    $$\Delta v_y = v \epsilon_{vr}$$

#### Case II: Depth Error (Multipath Ratio $R$)
**Scenario:** The radar measures a ghost depth: $\tilde{Z} = R \cdot Z_{real}$ (where $R$ is the ratio $Z_{ghost}/Z_{real}$).
**Mechanism:** This error affects the "Flow Term" $Z \dot{u}$ in (Eq. 1) and (Eq. 2).

*Note: The observed optical flow $\dot{u}$ is generated by the **real** physics. For an object with relative longitudinal velocity $v_{rel}$, the flow is $\dot{u} \approx -u v_{rel} / Z_{real}$.*

1.  **Derivation for $\Delta v_x$:**
    The solver computes $v_x = \tilde{Z} \dot{u} + u v_z$.
    Substituting the perturbed depth and the real flow equation:
    $$\tilde{v}_x = (R Z_{real}) \left( \frac{-u v_{rel}}{Z_{real}} \right) + u v_z$$
    $$\tilde{v}_x = -R u v_{rel} + u v_z$$
    The true velocity (where $R=1$) is $v_x = -u v_{rel} + u v_z$.
    The error is the difference:
    $$\Delta v_x = (-R u v_{rel}) - (-u v_{rel})$$
    $$\Delta v_x = -u v_{rel} (R - 1)$$

2.  **Derivation for $\Delta v_y$:**
    By symmetric derivation using vertical flow $\dot{v}$:
    $$\Delta v_y = -v v_{rel} (R - 1)$$

3.  **Derivation for $\Delta v_z$:**
    In (Eq. 4), $Z$ is multiplied by $(r_x \dot{u} + r_y \dot{v})$. Since $r_x, r_y \approx 0$ (the radar beam is aligned with the camera axis), this term is negligible.
    $$\Delta v_z \approx 0$$

#### Case III: Azimuth Error ($\epsilon_{rx}$)
**Scenario:** The radar unit vector is perturbed: $\tilde{r}_x = r_x + \epsilon_{rx}$.
**Mechanism:** This perturbs the denominator $D$ in (Eq. 4).
$$\tilde{D} = (r_x + \epsilon_{rx})u + r_y v + r_z = D + \epsilon_{rx} u$$

1.  **Derivation for $\Delta v_z$:**
    $$\tilde{v}_z = \frac{\text{Numerator}}{\tilde{D}} = \frac{\text{Numerator}}{D + \epsilon_{rx} u}$$
    Factor out $D$ (where Numerator/D = $v_z$):
    $$\tilde{v}_z = v_z \left( \frac{1}{1 + \frac{\epsilon_{rx} u}{D}} \right)$$
    Since $D \approx 1$:
    $$\text{Scaling Factor } S_x \approx \frac{1}{1 + \epsilon_{rx} u}$$

2.  **Derivation for $\Delta v_x$ and $\Delta v_y$:**
    Since $v_x$ and $v_y$ are linearly dependent on $v_z$ (plus the constant flow term, which is unaffected by radar angle), the dominant velocity component scales by the same factor.
    $$\tilde{v}_x \approx v_x \cdot S_x$$
    $$\tilde{v}_y \approx v_y \cdot S_x$$

#### Case IV: Elevation Error ($\epsilon_{ry}$)
**Scenario:** The radar unit vector is perturbed: $\tilde{r}_y = r_y + \epsilon_{ry}$.
**Mechanism:** Symmetric to Case III, but the perturbation depends on vertical pixel position $v$.

1.  **Derivation for all axes:**
    $$\tilde{D} = D + \epsilon_{ry} v$$
    $$\text{Scaling Factor } S_y \approx \frac{1}{1 + \epsilon_{ry} v}$$
    $$\tilde{\mathbf{v}} \approx \mathbf{v} \cdot S_y$$

---

### 3. Summary of Results (The 12 Combinations)

The following table summarizes the error $\Delta \mathbf{v}$ for each axis based on the derived equations.

| Input Error Source | Error in Lateral Velocity ($\Delta v_x$) | Error in Vertical Velocity ($\Delta v_y$) | Error in Longitudinal Velocity ($\Delta v_z$) |
| :--- | :--- | :--- | :--- |
| **Radial Velocity** ($\epsilon_{vr}$) | $\epsilon_{vr} \cdot u$ | $\epsilon_{vr} \cdot v$ | $\mathbf{\epsilon_{vr}}$ (Direct Additive) |
| **Depth / Multipath** ($R$) | $\mathbf{-u v_{rel} (R - 1)}$ | $\mathbf{-v v_{rel} (R - 1)}$ | $\approx 0$ |
| **Azimuth** ($\epsilon_{rx}$) | Scaled by $(1 + \epsilon_{rx} u)^{-1}$ | Scaled by $(1 + \epsilon_{rx} u)^{-1}$ | Scaled by $(1 + \epsilon_{rx} u)^{-1}$ |
| **Elevation** ($\epsilon_{ry}$) | Scaled by $(1 + \epsilon_{ry} v)^{-1}$ | Scaled by $(1 + \epsilon_{ry} v)^{-1}$ | Scaled by $(1 + \epsilon_{ry} v)^{-1}$ |

**Conclusion:**
The derivation proves that **Depth Errors (Multipath)** are the only source of error that scales linearly with the relative velocity ($v_{rel}$) and the depth ratio ($R$). This confirms that large depth discrepancies (typical of multipath) result in "supersonic" transverse velocity estimates, whereas radial velocity and angular errors result in minor additive or scaling deviations.